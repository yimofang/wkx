<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="net.emof.building.dao.QnrMapper">
  <resultMap id="BaseResultMap" type="net.emof.building.model.Qnr">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    <id column="id" jdbcType="VARCHAR" property="id" />
    <result column="fname" jdbcType="VARCHAR" property="fname" />
    <result column="isdelete" jdbcType="INTEGER" property="isdelete" />
    <result column="createtime" jdbcType="TIMESTAMP" property="createtime" />
    <result column="userid" jdbcType="INTEGER" property="userid" />
    <result column="codes" jdbcType="VARCHAR" property="codes" />
    <result column="confsid" jdbcType="VARCHAR" property="confsid" />
    <result column="rls" jdbcType="INTEGER" property="rls" />
    <result column="qbrief" jdbcType="VARCHAR" property="qbrief" />
    <result column="isphone" jdbcType="INTEGER" property="isphone" />
    <result column="browsenum" jdbcType="INTEGER" property="browsenum" />
    <result column="answernum" jdbcType="INTEGER" property="answernum" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    id, fname, isdelete, createtime, userid, codes, confsid, rls, qbrief, isphone, browsenum, 
    answernum
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    select 
    <include refid="Base_Column_List" />
    from qnr
    where id = #{id,jdbcType=VARCHAR}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    delete from qnr
    where id = #{id,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="net.emof.building.model.Qnr">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into qnr (id, fname, isdelete, 
      createtime, userid, codes, 
      confsid, rls, qbrief, 
      isphone, browsenum, answernum
      )
    values (#{id,jdbcType=VARCHAR}, #{fname,jdbcType=VARCHAR}, #{isdelete,jdbcType=INTEGER}, 
      #{createtime,jdbcType=TIMESTAMP}, #{userid,jdbcType=INTEGER}, #{codes,jdbcType=VARCHAR}, 
      #{confsid,jdbcType=VARCHAR}, #{rls,jdbcType=INTEGER}, #{qbrief,jdbcType=VARCHAR}, 
      #{isphone,jdbcType=INTEGER}, #{browsenum,jdbcType=INTEGER}, #{answernum,jdbcType=INTEGER}
      )
  </insert>
  <insert id="insertSelective" parameterType="net.emof.building.model.Qnr">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    insert into qnr
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="id != null">
        id,
      </if>
      <if test="fname != null">
        fname,
      </if>
      <if test="isdelete != null">
        isdelete,
      </if>
      <if test="createtime != null">
        createtime,
      </if>
      <if test="userid != null">
        userid,
      </if>
      <if test="codes != null">
        codes,
      </if>
      <if test="confsid != null">
        confsid,
      </if>
      <if test="rls != null">
        rls,
      </if>
      <if test="qbrief != null">
        qbrief,
      </if>
      <if test="isphone != null">
        isphone,
      </if>
      <if test="browsenum != null">
        browsenum,
      </if>
      <if test="answernum != null">
        answernum,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="id != null">
        #{id,jdbcType=VARCHAR},
      </if>
      <if test="fname != null">
        #{fname,jdbcType=VARCHAR},
      </if>
      <if test="isdelete != null">
        #{isdelete,jdbcType=INTEGER},
      </if>
      <if test="createtime != null">
        #{createtime,jdbcType=TIMESTAMP},
      </if>
      <if test="userid != null">
        #{userid,jdbcType=INTEGER},
      </if>
      <if test="codes != null">
        #{codes,jdbcType=VARCHAR},
      </if>
      <if test="confsid != null">
        #{confsid,jdbcType=VARCHAR},
      </if>
      <if test="rls != null">
        #{rls,jdbcType=INTEGER},
      </if>
      <if test="qbrief != null">
        #{qbrief,jdbcType=VARCHAR},
      </if>
      <if test="isphone != null">
        #{isphone,jdbcType=INTEGER},
      </if>
      <if test="browsenum != null">
        #{browsenum,jdbcType=INTEGER},
      </if>
      <if test="answernum != null">
        #{answernum,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="net.emof.building.model.Qnr">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update qnr
    <set>
      <if test="fname != null">
        fname = #{fname,jdbcType=VARCHAR},
      </if>
      <if test="isdelete != null">
        isdelete = #{isdelete,jdbcType=INTEGER},
      </if>
      <if test="createtime != null">
        createtime = #{createtime,jdbcType=TIMESTAMP},
      </if>
      <if test="userid != null">
        userid = #{userid,jdbcType=INTEGER},
      </if>
      <if test="codes != null">
        codes = #{codes,jdbcType=VARCHAR},
      </if>
      <if test="confsid != null">
        confsid = #{confsid,jdbcType=VARCHAR},
      </if>
      <if test="rls != null">
        rls = #{rls,jdbcType=INTEGER},
      </if>
      <if test="qbrief != null">
        qbrief = #{qbrief,jdbcType=VARCHAR},
      </if>
      <if test="isphone != null">
        isphone = #{isphone,jdbcType=INTEGER},
      </if>
      <if test="browsenum != null">
        browsenum = #{browsenum,jdbcType=INTEGER},
      </if>
      <if test="answernum != null">
        answernum = #{answernum,jdbcType=INTEGER},
      </if>
    </set>
    where id = #{id,jdbcType=VARCHAR}
  </update>
  <update id="updateByPrimaryKey" parameterType="net.emof.building.model.Qnr">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
    -->
    update qnr
    set fname = #{fname,jdbcType=VARCHAR},
      isdelete = #{isdelete,jdbcType=INTEGER},
      createtime = #{createtime,jdbcType=TIMESTAMP},
      userid = #{userid,jdbcType=INTEGER},
      codes = #{codes,jdbcType=VARCHAR},
      confsid = #{confsid,jdbcType=VARCHAR},
      rls = #{rls,jdbcType=INTEGER},
      qbrief = #{qbrief,jdbcType=VARCHAR},
      isphone = #{isphone,jdbcType=INTEGER},
      browsenum = #{browsenum,jdbcType=INTEGER},
      answernum = #{answernum,jdbcType=INTEGER}
    where id = #{id,jdbcType=VARCHAR}
  </update>
  
  <!-- 查询问卷下的所有问题与问题选项      xilongfei -->
  <resultMap extends="BaseResultMap" id="QnrResultMap" type="net.emof.building.model.Qnr">
 	<collection ofType="net.emof.building.model.QnrTitle" property="titles">
 		<id column="titleid" jdbcType="VARCHAR" property="id" />
	    <result column="qt_name" jdbcType="VARCHAR" property="fname" />
	    <result column="tstate" jdbcType="INTEGER" property="tstate" />
	    <result column="qnrmin" jdbcType="INTEGER" property="qnrmin" />
	    <result column="qnrmax" jdbcType="INTEGER" property="qnrmax" />
	    <result column="isitem" jdbcType="INTEGER" property="isitem" />
	 	<collection ofType="net.emof.building.model.QnrOption" property="options">
	  		<id column="optionid" jdbcType="VARCHAR" property="id" />
	    	<result column="qo_name" jdbcType="VARCHAR" property="fname" />
	  	</collection>
 	</collection>
 </resultMap>
  
  <!--根据会议id 查询问卷下的所有问题与问题选项  xilongfei -->
  <select id="getQnrDetails" resultMap="QnrResultMap">
	  	SELECT q.id, q.rls, qt.id AS titleid, qt.fname AS qt_name, qt.qnrmax, qt.qnrmin, qt.isitem, qt.tstate, 
			  qo.`id` AS optionid, qo.`fname` AS qo_name 
		FROM  qnr q
		    LEFT JOIN qnr_title qt ON qt.qnrid = q.id
		    LEFT JOIN qnr_option qo ON qt.`id` = qo.`titleid`
		<where>
		     and q.confsid=#{confid} AND q.isdelete=1 
		     <if test="rls == 1 ">
		    	 AND q.rls=1 
		     </if>
		     ORDER BY qt.`createtime`,qo.serial ASC	
		</where>
  </select>
  
  
</mapper>